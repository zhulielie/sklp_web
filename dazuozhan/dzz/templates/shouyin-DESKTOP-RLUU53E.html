{% extends "admin/base_site.html" %}
{% block extrahead %}
    <link rel="stylesheet" type="text/css" href="http://zcommon.oss-cn-shanghai.aliyuncs.com/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">




    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/select2/4.0.3/css/select2.min.css">
    {#    <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/chosen/1.6.2/chosen.min.css">#}

{% endblock %}
{% block content %}


    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-lg=12">
                <div class="row-fluid">
                    <div class="text-center">
                        <select id="huiyuan_search" style="width:100%;">
                            <option></option>
                            {% for x in huiyuan %}
                                <option value="{{ x.cellphone }}">{{ x.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <hr>
            <div class="col-lg-8">
                <div class="row-fluid">
                    <div class="">
                        <select id="yifu_search" style="width:100%;">
                            <option></option>
                            {% for x in yifu %}
                                <option value="{{ x.tiaomahao }}">{{ x.name }} {{ x.yanse }} {{ x.guige }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row-fluid text-center">
                    <div class="">
                        <table class="table table-striped ">

                            <caption>选购商品如下</caption>
                            <thead>
                            <tr>
                                <th style="width: 200px">
                                    款号
                                </th>
                                <th class="text-center">
                                    数量
                                </th>
                                <th class="text-center">
                                    单价
                                </th>
                                <th class="text-center">
                                    小计
                                </th>
                                <th style="length:20px">

                                </th>
                            </tr>
                            </thead>
                            <tbody id="suogoushangpin">

                            </tbody>


                            <tbody id="state">
                            <tr>
                                <th>

                                </th>
                                <th>
                                    总件数:<span id="shuliangheji">0</span>
                                </th>
                                <th>

                                </th>
                                <th>
                                    总金额:<span id="jiageheji">0</span>
                                </th>
                                <th>

                                </th>
                            </tr>

                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">

                <div class="row-fluid">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">应付金额</div>
                            <input class="form-control" type="text" id="yingfukuan" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <div>
                            <div class="input-group">
                                <div class="input-group-addon">兑换积分</div>
                                <input class="form-control" type="text" placeholder="53">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div>
                            <div class="input-group">
                                <div class="input-group-addon">实付金额</div>
                                <input class="form-control" type="text" placeholder="500">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div>
                            <div class="input-group">
                                <div class="input-group-addon">积分抵扣</div>
                                <input class="form-control" type="text" placeholder="20">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>





{% endblock %}

{% block zll_footer %}

    <script src="http://zcommon.oss-cn-shanghai.aliyuncs.com/jquery.3.1.1.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    {#    <script src="//cdn.bootcss.com/chosen/1.6.2/chosen.jquery.min.js"></script>#}
    <script src="//cdn.bootcss.com/select2/4.0.3/js/select2.min.js"></script>



    {#    <script src="//cdn.bootcss.com/bootstrap/3.3.7/fonts/glyphicons-halflings-regular.svg"></script>#}
    {#    <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/npm.js"></script>#}
    <script src="http://zcommon.oss-cn-shanghai.aliyuncs.com/sweetalert.min.js"></script>
    <script type="application/javascript">
        $(function () {
            $(document).on('click', ".yifu_delete", function () {
                        tmp = $(this)
                        swal({
                            title: "提醒",
                            text: "确定要删除？",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "确定",
                            closeOnConfirm: false
                        }, function () {
                            deleteitem(tmp.attr('jiage'))
                            tmp.parent().parent().remove()
                            swal("已删除!", "删除成功!", "success");
                        });


                    }
            )

            $("#huiyuan_search").select2({placeholder: '选择一位会员'})
            $("#yifu_search").select2({placeholder: '选择一件衣服'})


            $("#yifu_search").on("select2:select", function (e) {
                var nowvar = e.params.data.id


                $.get('/admin/dzz/yifu/json_yifu/' + nowvar, {}, function (data) {
                    if (data) {

                        var newtr = ['<tr >',
                            '  <td class="text-left">' + data.yifu.name + '</td>',
                            '  <td class="shuilang">' + 1 + '</td>',
                            '  <td>' + data.yifu.jiage + '</td>',
                            '  <td class="xiaoji">' + data.yifu.jiage + '</td><td><a class="btn btn-xs btn-danger yifu_delete" jiage="' + data.yifu.jiage + '">删除</a></td></tr>'].join("");

                        $("#suogoushangpin").prepend(newtr)
                        addnewitem(data.yifu.jiage)

                    }

                })

            });


        });
        addnewitem = function (jiage) {
            shuliangnow = 0
            jiagenow = 0
            shuliangnow = $("#shuliangheji").text()
            jiagenow = $("#jiageheji").text()
            shuliangnow = parseInt(shuliangnow) + 1
            jiagenow = parseInt(jiagenow) + parseInt(jiage)
            $("#shuliangheji").text(shuliangnow)
            $("#jiageheji").text(jiagenow)
            set_yinfukuan()
        }
        deleteitem = function (jiage) {
            shuliangnow = 0
            jiagenow = 0
            shuliangnow = $("#shuliangheji").text()
            jiagenow = $("#jiageheji").text()
            shuliangnow = parseInt(shuliangnow) - 1
            jiagenow = parseInt(jiagenow) - parseInt(jiage)
            $("#shuliangheji").text(shuliangnow)
            $("#jiageheji").text(jiagenow)
            set_yinfukuan()
        }
        set_yinfukuan = function () {
            $("yingfukuan").text($("#jiageheji").text())

        }
    </script>
{% endblock %}